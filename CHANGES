phpQLAdmin 2.3 Change Log

phpQLAdmin 2.3.3/GUI_TEMPLATE TO BE ANNOUNCED
	Bug fixes
	GUI layout changes
	Schema changes
	API changes
	  - Files moved about
	    + include/pql*		=> libs/
	    + include/dlw_porting.inc	=> libs/
	    + include/config*		=> config/
	    + include/defaults.inc	=> config/
	    + include/lang.en.inc	=> translations/
	    + include/thryn.ttf		=> tools/
	    + tools/normal.css		=> templates/
	    > All references in all files was updated!
	  - Remove the validateEmailFormat directory. Never used, I had my own
	    function(s) for this.
	  - Add the Smarty Template Engine (http://smarty.php.net) version 2.6.13 for use
	    with the soon-to-bee template driven phpQLAdmin.
	  - Add the PHPLib Template to Smarty Template (http://www.sanisoft.com/phplib2smarty/)
	    version 0.1 for use with the soon-to-bee template driven phpQLAdmin.
	  - Add the PHP Base Library (http://phplib.sourceforge.net/) version 7.4a for use
	    with the soon-to-bee template driven phpQLAdmin.

	Misc changes

phpQLAdmin 2.3.2 Release (Mar 11 2006)
	Bug fixes
	GUI layout changes
	  - Allow for picture to be added to user.
	    Closes: #72
	  - Add a 'Allow all chars in passwds' to the branch configuration page
	    (and check this new value whenever we verify the password).
	    Closes: #262
	  - Fix group management code. Patch by Aaron Collins.

	Schema changes
	  - Add attribute to specify if autogenerate uidNumber and gidNumber.
	    1.3.6.1.4.1.8767.3.2.1.26 => 'autoCreateUGidNumber'

	API changes
	  - Option to specify in the user template(s) whether to autogenerate uid- and
	    gid numbers or if to use the 'virtual user' within QmailLDAP.

	Misc changes
	  - Include a working Apache/mod_ldap_cfg config snippet and database branch example.
	  - Update the Apache readme (doc/README.apache) with the new Apache/mod_ldap_cfg
	    demo files.
	  - To stop PHP warnings when running with 'error_reporting=E_NOTICE':
	    + Make sure variables are initialized before use.
	    + Use 'counter < count(array)' in for loop instead of 'array[counter]'.
	    + Use 'if(empty(array))' instead of 'if(!array[part])' or 'if(!isset(array[part]))'.
	    + Use '@array[part]' instead of 'array[part]'.
	  - Possibility to export user, branch or QmailLDAP/Controls object as LDIF (either
	    output to local browser frame or save as local file).
	    Closes: #250
	  - Misc changes to the Webserver manager:
	    + The AccessDeny and AccessAllow must be arrays, not flat. Convert if not
	      already an array...
	    + Sort servers alphabetically.
	    + Cleanup the generation of the server buttons. Previosly only two in a row,
	      now fills the table as much as possible.
	    + Reword the 'headers' to the Apache information.
	    + The "PQL_ATTR_WEBSRV_OPTIONS" define was renamed to "PQL_ATTR_WEBSRV_SRV_REWRITE_OPTIONS".
	    + Add rewrite stuff (use pql_format_table_single() for Access{Deny,Allow}).
	    + Actually support the three levels of Apache objects described in doc/README.apache!
	      1. Server FQDN Container object (a very simple 'device' object).
	      2. Apache Virtual Host object (a 'ApacheServerName'd object).
	      3. Apache Location object (a 'ApacheSectionArg'd object).
	      This now reflects true in both the 'domain details->webserver manager' page AND in
	      creation and modifications of the three different type of objects.
	  - Host ACL and Sudo manager. Patch by Aaron Collins.

phpQLAdmin 2.3.1 Release (Aug 22 2005)
	Bug fixes
	  - Remove a duplicated 'if user is (super)admin' check in tables/user_details-access.inc.
	  - It is (very) possible for a user to have only ONE mail alias. In that case,
	    additionals isn't an array. So only do a foreach() if it IS and send the
	    alias directly to LDAP if it ISN'T.
	  - To be able to figure out if we should auto add locals or not, we're using
	    the root DN value for (this) host. But the root DN isn't supplied, so get
	    it.
	  - Spelling error in the pql_get_define() that retreives the 'auto add locals'
	    value: s/branch/rootdn/.
	  - Don't send each itteration of locals retreival to the LDAP server. Do that
	    ONCE _AFTER_ all values have been gathered...
	  - In the pql_add2array() wrapper, make sure that 'old' really exists, not
	    only isn't array...
	  - Catch DNS TTL RDN's in pql_domain_del() as well (there's a space in it
	    that ldap_list() croacs about...
	  - Allow for additional domain name to be set (in tables/domain_details-default.inc)
	    even if it isn't an array...
	  - Allow for empty default domain value. This if one wants/need to clear the
	    current value.
	  - Do not force locals and rcpthosts as array if automatic replication is set
	    (when asking for new value).
	  - Allow old values fetched from LDAP to be set but not array.
	  - Support ADDING and REPLACING additional domain name(s) by fixing
	    hardcoded call to 'array(delval, '')' for pql_control_update_domains().
	  - Missing semi-colon added after a pql_modify_attribute() call.
	  - Spelling error fixed in include/attrib.defaultdomain.inc: 's/$delval/$oldvalue/g'

	GUI layout changes
	  - Attachement (#64) for bug #275 changes the way the left-controls frame looks
	    (restrucured and more 'humane' wordings), changes the way 'multiple values'
	    are drawn. It also fixes sub-category buttons for/in all pages, much the way
	    the Domain/User views look like.
	  - The tables/control_details-nonprimmx.inc file is no longer used/needed since
	    include/attrib.control.nonprimmx.inc now works like the other control files
	    (with a print_view() and a print_form() function etc).
	  - If a password have been autogenerated, tick the 'Autogenerate password'
	    checkbox in the 'User data' create user page.
	  - Correctly retreive additional groups the user is member of. Patch by Aaron Collins.
	  - Add the 'memberuid' to list of attributes to allow editing (user_edit_attribute.php).
	    Patch by Aaron Collins.
	  - Instead of checking for 'system' type, check if the objectclass(es) we're
	    using to create the user with contains the 'posixAccount'. If it does,
	    THEN create the group object. Patch by Aaron Collins.
	  - Remove some 'MUST' and 'MAY' parameters from the pql_templates_check_attribute()
	    calls in tables/user_add-save.inc. If it's allowed, it's allowed! We don't
	    need to care if it's required or optional...
	    Patch by Aaron Collins.
	  - Deglobalize the "subbranch" value in tables/user_add-details.inc.
	  - Allow the creation of a Samba account. Patch by Aaron Collins.
	  - Show the NS, MX and AFSDB values correctly in the DNS view.
	  - Add 'empty table lines' between each template in the (user) templates view.
	  - In the pql_create_ldif() function, add a 'LDIF command separator' before
	    each command (not the very first though). This so that it can even easier
	    be cut-and-pasted...

	Schema changes
	  - Missing attributes 'relayMailFrom', 'maxRcptCount' and 'qmqpcIp' added.
	    1.3.6.1.4.1.7006.1.2.1.79 => 'relayMailFrom'
	    1.3.6.1.4.1.7006.1.2.1.80 => 'maxRcptCount'
	    1.3.6.1.4.1.7006.1.2.1.81 => 'qmqpcIp'

	API changes
	  - Rewrite and correctly implement caching. Not that I gained much, but still.
	    Example: Loading the left frame with my database (99 users) took 9 seconds
	             without caching and 6 seconds with...
	    No other speed increases where found (adding domains etc which usually take
	    some time).
	  - Complete rewrite of the include/attrib.config.inc:attribute_save() function.
	    Closes: #221
	  - Not so much a rewrite as cleanup of the include/pql_control.inc:pql_control_update_domains()
	    function. Move some parts as separate functions into include/pql_search.inc.
	    Closes: #258
	  - Not so much a rewrite as a cleanup of the include/attrib.additionaldomainname.inc
	    file. Remove duplication and redundant code. Simplify add/del/change decision(s).
	    Closes: #274
	    + Duplicate this fix in include/attrib.defaultdomain.inc.
	  - Changed the order parameters to pql_plugin_register() was specified.
	  - Add a parameter (label=...) to tools/navbutton.php instead of just sending the
	    label in argv[1].
	  - Remove the first parameter to pql_cache_add() - the DN. Better to take it from
	    the object (the previos second paramater, now the first and only). That way
	    we don't risk caching the object in the wrong place.
	  - New function - pql_format_table_empty() - to simplify the output of 'empty table
	    lines' (empty room between parts in a table).
	  - Some fixes in the pql_format_bool() function:
	    + If the input value is '0' or empty, don't do anything.
	    + Check for UPPER or lower cased true/false values.
	  - When retreiving a DN for a object and it (the object) IS cached, then
	    pql_search() will return a flat (one) object, so '$object[0]' isn't set...
	    Instead, '$object['dn']' IS set so return that...

	Misc changes
	  - Support sub-zones in the DNS manager. Only one level is supported at this
	    time though...
	  - Do some output buffer flushing at the end of each page. Might improve
	    performance somewhat (even though it don't seem like it).
	    Done with my own wrapper pql_flush().
	  - Use the PHP function empty() to check for set/unset variable. Patch by Aaron Collins.
	  - Include my templates as an LDIF in the demo directory.
	  - Support the file .DEBUG_PROFILING - show what time it is (as a UNIX timestamp)
	    at the start and end of the script. Might give SOME indication where speed
	    problems exists.
	  - Make sure that the browser don't cache the page(s). Add a 'Pragma: no-cache'
	    to header.html (which is included in almost every output script page).
	  - Rename the .DEBUG_ME_DEFINES to .DEBUG_DEFINES. More in line with the
	    other debug files...
	  - Create the file DEBUGGING.txt which describes how debuing can be done.
	  - Include a working Apache/mod_ldap_cfg config snippet and database branch example.
	  - Update the Apache readme (doc/README.apache) with the new Apache/mod_ldap_cfg
	    demo files.

phpQLAdmin 2.3.0 Release (Jun  8 2005)
	Bug fixes
	  - Session was started with the path specified in php.ini:session.cookie_path.
	    For me that was '/' which meant that if I have two (or more) phpQLAdmin
	    installations on the same server (which I do - stable, devel and demo etc),
	    they overwrote each others session variable.
	    To avoid this, we must set the 'session.cookie_path' using ini_set() BEFORE
	    session is started. Instead of doing this in every place where session_start()
	    is called, we include the new file 'include/pql_session.inc' which does
	    some additional magic.
	    + The 'session.cookie_path' init value must always end with a slash, so make
	      sure it does...
	      Should fix some problems with sessions that won't die or get's overwritten.
	    + Getting what type of browser the user is using is a session thing so move
	      it from left-head.html to include/pql_session.inc where it belongs...
	      This should REALLY fix the disappearance of the frame borders...
	    + Don't hardcode require()/include() (etc) calls to './'. Use the session value
	      'path' as prefix in _ALL_ (?) calls to require()/include().
	  - Overloading of variables in tables/domain_details-websrv.inc fixed ($server*
	    to $web_srv*).
 	  - If one enters a mailForwardingAddress and:
 	    + qmailDotMode		!= none
 	    + deliveryMode		!= noprogram
 	    + deliveryProgramPath	!= NULL
 	    + ldapDefaultDotMode	== ldapwithprog
 	    then there will be a COPY in the users local mailbox. Solve this by changing
 	    the 'qmailDotMode' and 'deliveryMode'.
	    + Make sure to re-enable local delivery for the user if not forwarding (any more).
	  - When (if) retreiving object classes the LDAP server understands, we must catch
	    attribute alias(es). A MAY/MUST on 'domainComponent' must translate to 'dc'
	    and back...
	  - Change the way 'cn' is modified. If we're called with an old value, we replace
	   _only_ that specific value. If no old value, replace the whole attribute list.
	  - When adding a user, the inclusion of the home directory must be done outside
	    of the 'if mailhost is allowed'.
	  - When _editing_ (changing) a common name for a user, include the old value in
	    the change.
	    + Support additions and deletions of 'cn' value(s).
	  - When retreiving domain details information, don't retreive 'facsimileTelephoneNumber'
	    twice...
	  - The 'pql_split_oldvalues(pql_get_define("PQL_CONF_WEBSRV_OC"))' directly
	    returns an array() so no need to go through them and add them to a two
	    dimensional array (which was named wrong - use pql_get_define("PQL_ATTR_OBJECTCLASS")
	    as we're supposed to).
	    + Use 'PQL_CONF_WEBSRV_OC' instead of the faulty 'PQL_ATTR_WEBSRV_OC'.
	    + Add define for 'ApacheSectionName', used by the webserver object manager.
	  - Include 'ApacheSectionName=VirtualHost' when creating a web server object,
	    othervise mod_ldap_cfg won't get it's virtual hosts...
	  - If the user logging in can't be found, we must clear the '_POST' value between
	    attempts, othervise we're trying to authenticate again (and again...)
	  - When an object class violation occured when adding an attribute to a object,
	    the combination of the old and the new object classes failed.
	  - If the root DN don't contain the user reference value, retreival of
	    domains/branches fails. Use a 'resonable default' (uid).
	  - If the root DN is a 'dc' object and domain/branch reference is 'ou',
	    we must use 'organizationalUnit' in the object class filter when retreiving
	    domains/branches... => 'ou=domain2.tld,dc=domain2,dc=tld'. Ugly, but ok.

	GUI layout changes
	  - Rewrite the way users are listed in the left frame. The attribute 'cn' is
	    the most obvious to show and the way that's shown is also rewritten.
	    + If a user have more than two fields (space separated - 'Ulf Turbo Fredriksson'),
	      then the _last_ part is the lastname and all the others are first names...
	      If memory serves me correctly, this isn't true for arabic/chinese names, but...
	    + After 'cn' comes 'givenName' and 'sn' and after that comes 'gecos'. Last
	      chance is the 'user reference attribute' (whatever that might be - it MUST
	      exists however).
	  - When creating a 'forwarding account' there are two possibilities. Either with
	    local delivery (as well as forwarding) or no local delivery (i.e. only forwarding).
	    Allow this with two radio buttons in the 'Additional account properties' page -
	    'Copy to' (default) or 'Forward to'.
	    + Create objects with real home dirs...
	  - Include a 'NOT' option for user search. Describe what it does and how it works.
 	  - Add a 'Force no local delivery' checkbox when _creating_ a mail forwarding address.
 	    ('Bug fixes' point 3 - mailForwardingAddress creation - above)
	  - If there is no MAY attributes in the user templates, we must say so (<i>None</i>)
	    instead of having an empty line.
	  - Change the sizes of the left frames (QmailLDAP/Controls an ezmlm should be WAY
	    smaller).
	  - Change wording from 'Server URL' to 'Server FQDN'.
	  - Have a resonable default welcome message (phpQLAdmin @ <SERVER NAME>) if
	    we don't have a PQL_CONF_WHOAREWE define.
	  - Change/fix the way the USER_HOST session value is set. I'm splitting and
	    combining in a way that was quite redundant - we ended up with the exact
	    same value as we started with! Wonder what I was thinking... :)
	  - Sort the domain/branch list according to the branch name value NOT the
	    DN. This means we must explode()/split() the DN into parts, recustruct a
	    new temporary array which we sort and then use that array as a base for
	    putting the new, correctly sorted array togheter.
	    + The function pql_get_domains() is now sorting the domains/branch list better
	      than asort() can do so no need to call asort() after pql_get_domains().
	  - Better/More debugging support. I forgot to die() (and not forward to view)
	    if the file .DEBUG_ME existed in some places.

	Schema changes
	  - Because of the change in the way 'forwarding accounts' where used/created,
	    I lost all purpose of the 'virtualBaseHomeDir' global attribute/configuration!
	    Remove all references to it.
	  - Four new attributes for remote ezmlm lists added to the 'phpQLAdminGlobal'
	    object class:
	    ezmlmRemote				1.3.6.1.4.1.8767.3.2.1.21
	    ezmlmRemoteHost			1.3.6.1.4.1.8767.3.2.4.20
	    ezmlmRemoteUser			1.3.6.1.4.1.8767.3.2.4.21
	    ezmlmRemoteRetreiveScript		1.3.6.1.4.1.8767.3.2.2.21
	  - To be able to remember localy added rcptHosts, I (phpQLAdmin) must put them
	    in another attribute. This to protected the value(s) from a manual replication.
	    The example comes from bug #257 - if the QLC host is only _listenening_ ('backup
	    MX') then there is no branch(es) that have the domain(s) configured as primary
	    nor additional domainname. If a manual replication takes place, then the information
	    about the domain(s) can't be found anywhere...
	    A new object class and a new attribute to add to the QLC object(s):
	    phpQLAdminMXHostAddition            1.3.6.1.4.1.8767.3.1.8      (object class)
            nonPrimaryRcptHosts                 1.3.6.1.4.1.8767.3.2.4.22   (attribute)
	  - Support SimScan configuration (added as MAY to phpQLAdminMXHostAddition and
	    phpQLAdminGlobal):
	    useSimScan	                        1.3.6.1.4.1.8767.3.2.1.22
	    simScanSpamAssassin                 1.3.6.1.4.1.8767.3.2.1.23
	    simScanClamAntiVirus                1.3.6.1.4.1.8767.3.2.1.24
	    simScanTrophie                      1.3.6.1.4.1.8767.3.2.1.25
	    simScanSpamAssassinHits             1.3.6.1.4.1.8767.3.2.4.23
	    simScanAttachmentSuffix             1.3.6.1.4.1.8767.3.2.4.24
	    + Configured/enabled in two places:
	      * Globaly per MX host (in a QmailLDAP/Controls object).
	      * Per branch object
	    + Script to extract and generate the simcontrol file (scripts/extract_simscan.pl)
	      is only started, not finished!

	Documentation changes
	  - Map the QmailLDAP/Controls manager -> doc/README.QmailLDAP_Controls-GUI.
	  - Include httpd.conf configuration snippet for web server manager README.

	API changes
	  - Administration of mailinglists located on remote server (i.e. not on the same
	    host where phpQLAdmin is running).
	    ==> See WARNING.txt! <==
	  - Native support for Kerberos V, using the php4-kadm5 module (from the URL
	    http://freshmeat.net/projects/php-kadm5).
	    + Do not export variables PQL_KADMIN_* to the support scripts.
	    + Closes bug 273.
	  - New function - pql_format_return_unixtime() - to return current time as
	    a UNIX timestamp. Good for profiling
	  - Slight API cleanup. To be able to introduce caching, I need to remove all
	    calls to the PHP functions ldap_*() and instead use my own wrappers:
		ldap_delete()   pql_write_del()         NEW!
		ldap_add()      pql_write_add()
	  - Started fixing the 'stupid URL's bug' (#212).
	    + Combind 'submit ==1' and 'action == del' into one if() in websrv_edit_attributes.php.
	    + All but domain and user edit is finished.
	  - Setup PQL_CONF_WEBSRV_OC in include/defaults.inc instead of in
	    include/config_attributes.inc.
	  - After using header() one MUST (!) use 'exit' so that the following code
	    isn't executed! Replace all calls to header() with my own wrapper that
	    does just that - calls header() (including the URI session value) and
	    then 'exit'...
	  - Merging two arrays don't work any more, so new PQL function:
	    pql_add2array(old, new) which adds the 'new' array to the 'old' via a
	    foreach() loop.

	Misc changes
	  - Lot's more folding tags added.
	  - Some more de-globalization (mainly in the ezmlm manager).
	  - When calling pql_create_ldif(), make sure we know which 'function' that
	    called it.
	    + Additional fourth param: add HTML newline or not.
	  - Slight rewrite in the user addition.
	    + Retreive enryption schemes ONCE (in user_add.php instead of tables/user_add-details.inc)
	    + New function pql_user_add_retreive_encryption_schemes() that takes
	      care of this easier.
	    + Allow password/scheme to be entered if password is allowed by the template
	      in addition to if the default password scheme is empty, or we're running
	      in advanced mode.
	  - The attribute 'cn' (common name) is very good/nice to have multi-valued so
	    this is now supported in the [user]->User data page.
	    + This forced a small change to include/pql_formating.inc:pql_format_table_single(),
	      namely the inclusion of a modify link/text entry (to get the edit button).
	    + Use include/pql_formating.inc:pql_format_table_single() in the [user]->User
	      data page instead of hardcoded HTML table rows etc. Not only was that cleaner,
	      it gave a nicer look when using/allowing multiple values...
	  - Add the ACI attribute(s) in the branch object as well.
	    + Simplify the ACI attributes - one line is enough.

[all changelog for <2.3 branch have been removed for space reasons]
