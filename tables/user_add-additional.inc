<?php /* $Id: user_add-additional.inc,v 1.24.2.1 2005-02-12 05:19:17 turbo Exp $ */ ?>
  <form action="<?=$_SERVER["PHP_SELF"]?>" method="post" accept-charset="UTF-8">
    <!-- Some hidden values from previous page(s) -->
<?php if(pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_CN"))) { ?>
    <input type="hidden" name="surname"            value="<?=urlencode($_REQUEST["surname"])?>">
<?php } ?>
<?php if(pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_SN"))) { ?>
    <input type="hidden" name="name"               value="<?=urlencode($_REQUEST["name"])?>">
<?php } ?>
<?php if(pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_MAIL"))) { ?>
    <input type="hidden" name="email"              value="<?=$_REQUEST["email"]?>">
    <input type="hidden" name="email_domain"       value="<?=$_REQUEST["email_domain"]?>">
    <input type="hidden" name="include_additional" value="<?=$_REQUEST["include_additional"]?>">
<?php } ?>
<?php if(pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_UID"))) { ?>
    <input type="hidden" name="uid"                value="<?=$_REQUEST["uid"]?>">
<?php } ?>
<?php if(pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_PASSWD"))) { ?>
    <input type="hidden" name="autogenerate"       value="<?=$_REQUEST["autogenerate"]?>">
    <input type="hidden" name="password"           value="<?=$_REQUEST["password"]?>">
    <input type="hidden" name="pwscheme"           value="<?=$_REQUEST["pwscheme"]?>">
    <input type="hidden" name="crypted"            value="<?=$_REQUEST["crypted"]?>">
<?php } ?>
<?php if(pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_FORWARDS"))) { ?>
    <input type="hidden" name="forwardingaddress"  value="<?=$_REQUEST["forwardingaddress"]?>">
<?php } ?>
    <input type="hidden" name="subbranch"          value="<?=$url["subbranch"]?>">
<?php if(pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_ISACTIVE"))) { ?>
    <input type="hidden" name="account_status" value="<?=$_REQUEST["account_status"]?>">
<?php } ?>

    <table cellspacing="0" cellpadding="3" border="0">
<?php if(($_REQUEST["autogenerate"] and pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"],
																	  pql_get_define("PQL_ATTR_PASSWD"))) or
		 pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_HOMEDIR")) or
		 pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_MAILSTORE")) or
		 pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_MAILHOST")))
	  {
?>
      <th colspan="3" align="left"><?=$LANG->_('Additional account properties')?></th>
<?php }

	  if($_REQUEST["autogenerate"] and pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_PASSWD"))) {
?>
        <!-- Show the autogenerated password -->
        <tr class="<?php pql_format_table(); ?>">
          <td class="title" valign="top"><?=$LANG->_('Autogenerated password')?></td>
          <td><?=$_REQUEST["password"]?></td>
        </tr>

        <input type="hidden" name="password_shown" value="1">
<?php }

	  if(pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_HOMEDIR"))) {
?>
        <!-- Home directory -->
        <tr class="<?php pql_format_table(); ?>">
          <td class="title" valign="top"><?=$LANG->_('Path to homedirectory')?></td>
          <td>
<?php   if($_REQUEST["homedirectory"]) { ?>
            <?=$_REQUEST["homedirectory"]?>
            <input type="hidden" name="homedirectory" value="<?=$_REQUEST["homedirectory"]?>">
<?php   } else { ?>
            <input type="text" name="homedirectory" size="30">
<?php   } ?>
          </td>
        </tr>

<?php } // Allowing home directory

	  if(pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_MAILSTORE"))) {
		if($_SESSION["ADVANCED_MODE"] or !$_REQUEST["maildirectory"]) {
?>
        <!-- MailMessageStore -->
        <tr class="<?php pql_format_table(); ?>">
          <td class="title"><?=$LANG->_('Path to mailbox')?></td>
          <td>
<?php		if($_REQUEST["maildirectory"]) { ?>
            <?=$_REQUEST["maildirectory"]?>
            <input type="hidden" name="maildirectory" value="<?=$_REQUEST["maildirectory"]?>">
<?php   	} else { ?>
            <input type="text" name="maildirectory" size="30">
<?php   	} ?>
          </td>
        </tr>

        <tr></tr>
<?php	} else { ?>
        <input type="hidden" name="maildirectory" value="<?=$_REQUEST["maildirectory"]?>">
<?php	}
	  }

	  if(pql_templates_check_attribute($_pql->ldap_linkid, $_REQUEST["template"], pql_get_define("PQL_ATTR_MAILHOST"))) { ?>
        <!-- Mailhost -->
        <tr class="<?php pql_format_table(); ?>">
          <td class="title" valign="top"><?=$LANG->_('Mail server')?></td>
          <td>
            <?php echo pql_format_error_span($error_text["userhost"]); ?>
<?php	if($_REQUEST["userhost"]["qlc"]) {
			// It's defined - QmailLDAP/Controls object

			for($i=0; $_REQUEST["userhost"]["qlc"][$i]; $i++) {
?>
            <input type="radio" name="host" value="<?=$_REQUEST["userhost"]["qlc"][$i]?>" <?php
				if(!$_REQUEST["userhost"]["qlc"][1] and !$_REQUEST["userhost"]["dns"]) { 
				  // This is the default, IF:
				  // 1. There's only ONE QmailLDAP/Controls object
				  //    AND
				  // 2. There's no DNS entry
				  echo "CHECKED";
				}
?>>
            <b><?=pql_maybe_idna_decode($_REQUEST["userhost"]["qlc"][$i])?></b><br>
<?php		}
		} 

		if($_REQUEST["userhost"]["dns"] and 
		   ($_REQUEST["userhost"]["qlc"] and !in_array($_REQUEST["userhost"]["dns"], $_REQUEST["userhost"]["qlc"])))
		{
			// It's defined - DNS entry (and it don't exists as QMailLDAP/Controls object)
?>
            <input type="radio" name="host" value="<?=$_REQUEST["userhost"]["dns"]?>" CHECKED>
            <b><?=$_REQUEST["userhost"]["dns"]?></b><br>
<?php	} ?>
            <input type="text" name="host" size="30">
          </td>
        </tr>
<?php } // if allowing mail server ?>
      </th>
    </table>
  
    <input type="hidden" name="template"       value="<?=$_REQUEST["template"]?>">
    <input type="hidden" name="page_curr"      value="two">
    <input type="hidden" name="page_next"      value="save">
    <input type="hidden" name="domain"         value="<?=$url["domain"]?>">
    <input type="hidden" name="rootdn"         value="<?=$url["rootdn"]?>">
    <br>
    <input type="submit" value="<?=$LANG->_('Save')?>">
  </form>

<?php
/*
 * Local variables:
 * mode: php
 * mode: font-lock
 * tab-width: 4
 * End:
 */
?>
