<?php /* $Id: user_add-additional.inc,v 1.30 2005-05-18 20:29:22 turbo Exp $ */ ?>
  <form action="<?=$_SERVER["PHP_SELF"]?>" method="post" accept-charset="UTF-8">
    <!-- Some hidden values from previous page(s) -->
<?php if($_REQUEST["surname"] and pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_CN"))) { ?>
    <input type="hidden" name="surname"            value="<?=urlencode($_REQUEST["surname"])?>">
<?php } ?>
<?php if($_REQUEST["name"] and pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_SN"))) { ?>
    <input type="hidden" name="name"               value="<?=urlencode($_REQUEST["name"])?>">
<?php } ?>
<?php if($_REQUEST["mail"] and pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_MAIL"))) { ?>
    <input type="hidden" name="mail"               value="<?=$_REQUEST["mail"]?>">
    <input type="hidden" name="email_domain"       value="<?=$_REQUEST["email_domain"]?>">
    <input type="hidden" name="include_additional" value="<?=$_REQUEST["include_additional"]?>">
<?php } ?>
<?php if($_REQUEST["uid"] and pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_UID"))) { ?>
    <input type="hidden" name="uid"                value="<?=$_REQUEST["uid"]?>">
<?php } ?>
<?php if($_REQUEST["password"] and pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_PASSWD"))) { ?>
    <input type="hidden" name="autogenerate"       value="<?=$_REQUEST["autogenerate"]?>">
    <input type="hidden" name="password"           value="<?=$_REQUEST["password"]?>">
    <input type="hidden" name="pwscheme"           value="<?=$_REQUEST["pwscheme"]?>">
    <input type="hidden" name="crypted"            value="<?=$_REQUEST["crypted"]?>">
<?php } ?>
<?php if($_REQUEST["clear_text_password"] and pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_PASSWD_CLEAR"))) { ?>
    <input type="hidden" name="clear_text_password" value="<?=$_REQUEST["clear_text_password"]?>">
<?php } ?>
<?php if($_REQUEST["forwardingaddress"] and pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_FORWARDS"))) { ?>
    <input type="hidden" name="forwardingaddress"  value="<?=$_REQUEST["forwardingaddress"]?>">
<?php } ?>
    <input type="hidden" name="subbranch"          value="<?=$url["subbranch"]?>">
<?php if($_REQUEST["account_status"] and pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_ISACTIVE"))) { ?>
    <input type="hidden" name="account_status"     value="<?=$_REQUEST["account_status"]?>">
<?php } ?>
<?php if($_REQUEST["loginshell"] and pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_LOGINSHELL"))) { ?>
    <input type="hidden" name="loginshell"         value="<?=$_REQUEST["loginshell"]?>">
<?php } ?>

    <table cellspacing="0" cellpadding="3" border="0">
<?php if(($_REQUEST["autogenerate"] and pql_templates_check_attribute($_pql->ldap_linkid, $template,
																	  pql_get_define("PQL_ATTR_PASSWD"))) or
		 pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_HOMEDIR")) or
		 pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_MAILSTORE")) or
		 pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_MAILHOST")))
	  {
?>
      <th colspan="3" align="left"><?=$LANG->_('Additional account properties')?></th>
<?php }

	  if($_REQUEST["autogenerate"] and pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_PASSWD"))) {
?>
        <!-- Show the autogenerated password -->
        <tr class="<?php pql_format_table(); ?>">
          <td class="title" valign="top"><?=$LANG->_('Autogenerated password')?></td>
          <td><?=$_REQUEST["password"]?></td>
        </tr>

        <input type="hidden" name="password_shown" value="1">
<?php }

	  if(pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_HOMEDIR"))) {
?>
        <!-- Home directory -->
        <tr class="<?php pql_format_table(); ?>">
          <td class="title" valign="top"><?=$LANG->_('Path to homedirectory')?></td>
          <td>
            &nbsp;&nbsp;&nbsp;
<?php   if($_REQUEST["homedirectory"]) { ?>
            <?=$_REQUEST["homedirectory"]?>
            <input type="hidden" name="homedirectory" value="<?=$_REQUEST["homedirectory"]?>">
<?php   } else { ?>
            <input type="text" name="homedirectory" size="60">
<?php   } ?>
          </td>
        </tr>

<?php } // Allowing home directory

	  if($_REQUEST["mail"] and
		 pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_MAILSTORE")))
      {
		if($_SESSION["ADVANCED_MODE"] or !$_REQUEST["maildirectory"]) {
?>
        <!-- MailMessageStore -->
        <tr class="<?php pql_format_table(); ?>">
          <td class="title"><?=$LANG->_('Path to mailbox')?></td>
          <td>
            &nbsp;&nbsp;&nbsp;
<?php		if($_REQUEST["maildirectory"]) { ?>
            <?=$_REQUEST["maildirectory"]?>
            <input type="hidden" name="maildirectory" value="<?=$_REQUEST["maildirectory"]?>">
<?php   	} else { ?>
            <input type="text" name="maildirectory" size="60">
<?php   	} ?>
          </td>
        </tr>

        <tr></tr>
<?php	} else { ?>
        <input type="hidden" name="maildirectory" value="<?=$_REQUEST["maildirectory"]?>">
<?php	}
	  } // Allowing mailbox path

	  if($_REQUEST["mail"] and
		 pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_FORWARDS")))
      {
?>
        <tr class="<?php pql_format_table(); ?>">
          <td class="title" valign="top"><?=$LANG->_('Forward mail to')?></td>
          <td>
            &nbsp;&nbsp;&nbsp;
<?php   if($_REQUEST["forwardingaddress"]) { ?>
            <?=$_REQUEST["forwardingaddress"]?>
            <input type="hidden" name="forwardingaddress" value="<?=$_REQUEST["forwardingaddress"]?>">
<?php   } else { ?>
            <input type="text" name="forwardingaddress" size="60">
<?php   } ?>
            <br>
            &nbsp;&nbsp;&nbsp;
            <input type="radio"  name="forwardingtype" value="copyto" <?php if(($forwardingtype == 'copyto') or !$forwardingtype) { ?>CHECKED<?php } ?>><?=$LANG->_('Copy to')?>
            <input type="radio"  name="forwardingtype" value="moveto" <?php if($forwardingtype == 'moveto') { ?>CHECKED<?php } ?>><?=$LANG->_('Forward to')?>
            <br>
          </td>
        </tr>

        <tr class="<?php pql_format_table(); ?>">
          <td class="title" valign="top"></td>
          <td class="message">
            &nbsp;&nbsp;&nbsp;
            <img src="images/info.png" width="16" height="16" border="0">
            <?=$LANG->_('(Only used if forwarding address is specified)')?>
          </td>
        </tr>

<?php } // Allowing mail forwarding address

	  if($_REQUEST["mail"] and
		 pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_MAILHOST")))
      {
?>
        <!-- Mailhost -->
        <tr class="<?php pql_format_table(); ?>">
          <td class="title" valign="top"><?=$LANG->_('Mail server')?></td>
          <td>
<?php	if(($_REQUEST["mail"] and 
			pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_MAILHOST")))
		   or
		   ($_REQUEST["mail"] or
			pql_templates_check_attribute($_pql->ldap_linkid, $template, pql_get_define("PQL_ATTR_MAILHOST"), 'MUST')))
		{
			 echo "            ".pql_templates_mark_importance(1);
		}
?>
            <?php echo pql_format_error_span($error_text["userhost"]); ?>
<?php	// 'retreive' all MX hosts
		$MX_HOSTS = array(); // So that in_array() won't fail if there is no QLC hosts...
		if($_REQUEST["userhost"]["qlc"]) {
			// It's defined - QmailLDAP/Controls object
			for($i=0; $_REQUEST["userhost"]["qlc"][$i]; $i++)
			  $MX_HOSTS[] = $_REQUEST["userhost"]["qlc"][$i];
		}

		if($_REQUEST["userhost"]["dns"] and !in_array($_REQUEST["userhost"]["dns"], $MX_HOSTS))
		  $MX_HOSTS[] = $_REQUEST["userhost"]["dns"];


		// Show all MX hosts we know about
		for($i=0; $MX_HOSTS[$i]; $i++) {
?>
            <input type="hidden" name="host_<?=$i?>" value="<?=$MX_HOSTS[$i]?>">
<?php		if($i >= 1) echo "&nbsp;&nbsp;"; ?>
            <input type="radio"  name="host"   value="<?=$i?>"<?php if($i==0) { $checked = 1; ?> CHECKED<?php } ?>>
            <b><?=pql_maybe_idna_decode($MX_HOSTS[$i])?></b><br>
<?php	}
?>

<?php	if($i >= 1) echo "&nbsp;&nbsp;"; ?>
            <input type="radio"  name="host"   value="<?=$i?>"<?php if(!$checked) { $checked = 1; ?> CHECKED<?php } ?>>
            <b><?=$LANG->_('User defined')?></b>:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?php if($i >= 1) { echo "&nbsp;&nbsp;\n"; } else { echo "\n"; } ?>
            <input type="text"   name="host_<?=$i?>" size="56">
            <input type="hidden" name="text_host" value="<?=$i?>">
          </td>
        </tr>
<?php } // if allowing mail server ?>
      </th>
    </table>
  
    <input type="hidden" name="template"       value="<?=$_REQUEST["template"]?>">
    <input type="hidden" name="page_curr"      value="two">
    <input type="hidden" name="page_next"      value="save">
    <input type="hidden" name="domain"         value="<?=$url["domain"]?>">
    <input type="hidden" name="rootdn"         value="<?=$url["rootdn"]?>">
    <br>
    <input type="submit" value="<?=$LANG->_('Save')?>">
  </form>

<?php
/*
 * Local variables:
 * mode: php
 * mode: font-lock
 * tab-width: 4
 * End:
 */
?>
